{{- range .Values.clusters }}
---
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: traefik-{{ . }}
  namespace: argocd
  labels:
    initial: "yes"
    cluster: "{{ . }}"
    app: traefik
spec:
  project: {{ $.Values.project }}
  source:
    repoURL: {{ $.Values.repoURL }}
    targetRevision: HEAD
    path: traefik
  destination:
    name: {{ . }}
    namespace: traefik
---
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: nginx-{{ . }}
  namespace: argocd
  labels:
    initial: "yes"
    cluster: "{{ . }}"
    app: nginx
spec:
  project: {{ $.Values.project }}
  source:
    repoURL: {{ $.Values.repoURL }}
    targetRevision: HEAD
    path: nginx
  destination:
    name: {{ . }}
    namespace: default
---
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: metrics-server-{{ . }}
  namespace: argocd
  labels:
    initial: "yes"
    cluster: "{{ . }}"
    app: metrics-server
spec:
  project: {{ $.Values.project }}
  source:
    repoURL: {{ $.Values.repoURL }}
    targetRevision: HEAD
    path: metrics-server
  destination:
    name: {{ . }}
    namespace: kube-system
---

{{ range $i, $e := until 8 }}
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: kad-v{{ $i }}-{{ . }}
  namespace: argocd
  labels:
    cluster: "{{ . }}"
    app: kad
spec:
  project: {{ $.Values.project }}
  source:
    repoURL: {{ $.Values.repoURL }}
    targetRevision: HEAD
    path: app_v{{ $i }}
  destination:
    name: {{ . }}
    namespace: kad
---
{{ end }}
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: kad-ingress-{{ . }}
  namespace: argocd
  labels:
    cluster: "{{ . }}"
    app: kad-ingress
spec:
  project: {{ $.Values.project }}
  source:
    repoURL: {{ $.Values.repoURL }}
    targetRevision: HEAD
    path: ingress
  destination:
    name: {{ . }}
    namespace: kad
---
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: prometheus-{{ . }}
  namespace: argocd
  labels:
    cluster: "{{ . }}"
    app: prometheus
spec:
  project: {{ $.Values.project }}
  source:
    repoURL: {{ $.Values.repoURL }}
    targetRevision: HEAD
    path: prometheus
  destination:
    name: {{ . }}
    namespace: prometheus
{{- end }}
